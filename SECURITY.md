# Security Policy

## Supported Versions

| Version | Supported          |
| ------- | ------------------ |
| Latest  | :white_check_mark: |

## Reporting Security Vulnerabilities

If you discover a security vulnerability, please report it by creating an issue or contacting the maintainers directly. Do not include sensitive information in public issues.

## Security Best Practices

### 1. Sensitive Data Management

**Never commit sensitive data to the repository:**
- ✅ Use `terraform.tfvars.example` as a template
- ✅ Keep actual secrets in local `terraform.tfvars` (gitignored)
- ✅ Use environment variables for CI/CD
- ❌ Never commit API keys, passwords, or tokens

### 2. Configuration Security

**Terraform Variables:**
- All sensitive variables are marked with `sensitive = true`
- Use strong, unique passwords and API keys
- Regularly rotate credentials

**Examples of sensitive data to protect:**
```hcl
# These should NEVER be in version control:
tailscale_ip = "100.x.x.x"           # Your actual Tailscale IP
# Any API keys, passwords, or personal information
```

### 3. Network Security

**Tailscale Integration:**
- Services are only accessible through encrypted Tailscale network
- No public internet exposure by default
- CoreDNS provides secure DNS resolution within Tailscale

**HTTPS Everywhere:**
- All web traffic encrypted via Traefik SSL termination
- End-to-end encryption through Tailscale tunnels

### 4. Container Security

**Security Contexts:**
- Non-root execution for all services
- Read-only filesystems where possible
- Minimal capabilities (drop ALL, add only required)
- No privilege escalation

**Resource Limits:**
- CPU and memory limits enforced
- Prevents resource exhaustion attacks

### 5. Kubernetes Security

**Namespace Isolation:**
- Services run in dedicated `homelab` namespace
- Traefik isolated in `traefik` namespace
- RBAC enabled for service accounts

**Secrets Management:**
- PostgreSQL passwords auto-generated by Helm
- Kubernetes secrets used for sensitive data
- No hardcoded credentials in manifests

## Security Checklist

Before deploying:

- [ ] Copy `terraform.tfvars.example` to `terraform.tfvars`
- [ ] Fill in your actual values in `terraform.tfvars`
- [ ] Verify `.gitignore` excludes `*.tfvars`
- [ ] Check no sensitive data in version control
- [ ] Use strong, unique passwords
- [ ] Configure Tailscale MagicDNS properly
- [ ] Review resource limits and security contexts

## Security Scanning

Regularly scan your deployment:

```bash
# Check for sensitive files in git
git ls-files | grep -E "(\.tfvars|secret|key|token)"

# Scan for exposed secrets
grep -r -i "password\|secret\|key\|token" . --include="*.tf" --include="*.md"

# Verify Kubernetes security
kubectl get pods -n homelab -o jsonpath='{.items[*].spec.securityContext}'
```

## Incident Response

If sensitive data is accidentally committed:

1. **Immediate Actions:**
   - Revoke/rotate all exposed credentials
   - Remove sensitive data from repository
   - Force push if necessary (breaking change)

2. **Recovery:**
   - Generate new credentials
   - Update configurations
   - Verify security posture

## Contact

For security questions or concerns, please contact the repository maintainers.